{% load static django_bootstrap5 %}
<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dashboard khách hàng</title>
    {% bootstrap_css %}
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
    <style>
        body{background:#f5f8ff}
        .wrap{max-width:1200px;margin:0 auto;padding:18px}
        .card{border-radius:14px}
        .table thead th{white-space:nowrap}
    </style>
</head>
<body>
<div class="wrap">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="mb-0 text-primary">Dashboard khách hàng</h3>
        <div>
        <a class="btn btn-outline-secondary me-2" href="{% url 'admin:index' %}" target="_blank">Admin</a>
        <a class="btn btn-success" href="{% url 'management:export_csv' %}?{{ request.GET.urlencode }}">Xuất CSV</a>
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
        <form method="get" class="row g-2">
            <div class="col-12 col-md-3">
            <label class="form-label">Tìm kiếm</label>{{ form.q }}
            </div>
            <div class="col-6 col-md-2">
            <label class="form-label">Từ ngày</label>{{ form.date_from }}
            </div>
            <div class="col-6 col-md-2">
            <label class="form-label">Đến ngày</label>{{ form.date_to }}
            </div>
            <div class="col-6 col-md-2">
            <label class="form-label">Tỉnh/TP</label>{{ form.province }}
            </div>
            <div class="col-6 col-md-2">
            <label class="form-label">Công việc</label>{{ form.work_status }}
            </div>
            <div class="col-6 col-md-1">
            <label class="form-label">Giới tính</label>{{ form.gender }}
            </div>
            <div class="col-12 d-flex gap-2 mt-1">
            <button class="btn btn-primary">Lọc</button>
            <a class="btn btn-outline-secondary" href="{% url 'management:dashboard' %}">Xóa lọc</a>
            </div>
        </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Họ tên</th>
                <th>Giới tính</th>
                <th>SĐT</th>
                <th>CCCD</th>
                <th>Tỉnh/TP</th>
                <th>Thu nhập</th>
                <th>Đăng ký</th>
                <th>Tạo lúc</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for r in rows %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.full_name }}</td>
                <td>{{ r.get_gender_display }}</td>
                <td>{{ r.phone_number }}</td>
                <td>{{ r.id_card }}</td>
                <td>{{ r.get_permanent_address_display }}</td>
                <td>{{ r.income|floatformat:0 }}</td>
                <td>{{ r.loan_amount|floatformat:0 }}</td>
                <td>{{ r.created_at|date:"H:i d/m/Y" }}</td>
                <td><a class="btn btn-sm btn-outline-primary" href="{% url 'management:customer_detail' r.pk %}">Chi tiết</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="10" class="text-center text-muted py-4">Chưa có dữ liệu</td></tr>
            {% endfor %}
            </tbody>
        </table>
        </div>

        {% if is_paginated %}
        <div class="card-body">
        <nav>
            <ul class="pagination mb-0">
            {% if page_obj.has_previous %}
                <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if querystring %}&{{ querystring }}{% endif %}">«</a>
                </li>
            {% else %}<li class="page-item disabled"><span class="page-link">«</span></li>{% endif %}

            <li class="page-item disabled"><span class="page-link">
                Trang {{ page_obj.number }}/{{ page_obj.paginator.num_pages }}
            </span></li>

            {% if page_obj.has_next %}
                <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if querystring %}&{{ querystring }}{% endif %}">»</a>
                </li>
            {% else %}<li class="page-item disabled"><span class="page-link">»</span></li>{% endif %}
            </ul>
        </nav>
        </div>
        {% endif %}
    </div>
</div>
{% bootstrap_javascript %}
</body>
</html>
